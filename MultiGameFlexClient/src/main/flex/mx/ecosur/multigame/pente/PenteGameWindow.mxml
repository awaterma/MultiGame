<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" 
    xmlns:pente="mx.ecosur.multigame.pente.*" 
    xmlns:component="mx.ecosur.multigame.component.*"
    backgroundGradientColors="[#222222, #333333]" backgroundColor="#333333">
    
    <mx:Metadata>
        [Event(name="complete")]
    </mx:Metadata>
    
    <mx:Style source="~/style.css"/>
    
    <mx:XMLList id="menuXML">
        <menuitem label="Game">
        	<menuitem label="Resign"/>
        </menuitem>
        <menuitem label="Help">
            <menuitem label="How to Play"/>
        </menuitem>
    </mx:XMLList>

    <mx:ApplicationControlBar id="controlBar"  
        dock="true">
        <mx:MenuBar height="100%" 
            dataProvider="{menuXML}" 
            labelField="@label" 
            showRoot="true"
            />
    </mx:ApplicationControlBar>

    <mx:HBox  
        width="100%" height="100%" 
        paddingBottom="10" paddingTop="10" paddingLeft="10" paddingRight="10"
        creationComplete="init()">
    <mx:Script> 
        <![CDATA[
        	import mx.controls.Alert;
        	import mx.events.ResizeEvent;
            import mx.events.MenuEvent; 
            import mx.collections.ArrayCollection;
            import flash.net.URLLoader;
            
            import mx.ecosur.multigame.entity.Game;
            import mx.ecosur.multigame.entity.Move;
            import mx.ecosur.multigame.entity.GamePlayer;
            import mx.ecosur.multigame.entity.ChatMessage;
            import mx.ecosur.multigame.pente.entity.PenteGame;
            
            private var _controller:PenteGameController;
            private var _currentPlayer:GamePlayer;
            
            //TODO: Find efficient way to pass rows and columns to penteBoard as initial parameters
            [Bindable]
            public var rows:int;
            [Bindable]
            public var columns:int;
            
            public function set currentPlayer(currentPlayer:GamePlayer):void{
                _currentPlayer = currentPlayer;
            }
            
            [Bindable]
            public function get currentPlayer():GamePlayer{
                return _currentPlayer;
            }
             
            public function init():void{
                _controller = new PenteGameController(_currentPlayer, board, chatPanel, playersViewer, tokenStore, gameStatus, moveViewer, animateLayer);
            }
            
            /* Only events that effect this container are handled, all others
               relevent to application lifecycle should be listend to by 
               Parent containers (event-bubbling) */
            private function handleMenuClick(evt:MenuEvent):void { 
                if (evt.label == 'How to Play') {
                	/* We should load an XML file containing help information, and then
                	   display this help file in a simple alert Window */
                	var helpText:String = "When it's your turn, simply drag a token from the left-hand-side to an unoccupied position on the main central board.";
                	var alert:Alert = Alert.show(helpText,"How To Play", Alert.OK,this);  
                } else if (evt.label=='Resign') {
                    this.dispatchEvent(new Event("complete"));
                }
            }
            
        ]]>
    </mx:Script>
    <mx:VBox id="leftBox" width="200" height="100%">
        <component:GameStatus id="gameStatus" width="100%" />   
        <component:TokenStore id="tokenStore" currentPlayer="{currentPlayer}" tokenSize="{board.tokenSize}" width="100%"/>
        <pente:PenteMoveViewer id="moveViewer" title="Move History" width="100%" height="100%"/>
    </mx:VBox>
    <mx:VBox id="centerBox" width="100%" height="100%">
        <pente:PenteBoard id="board" width="100%" height="100%" nRows="19" nCols="19"/>
    </mx:VBox>
    <mx:VBox id="rightBox" height="100%" width="300">
        <mx:Panel title="Players" width="100%">
            <pente:PentePlayersViewer id="playersViewer" width="100%" />
        </mx:Panel>
        <component:ChatPanel id="chatPanel" width="100%" height="100%" currentPlayer="{currentPlayer}" />
    </mx:VBox>
    <mx:UIComponent id="animateLayer" />
</mx:HBox>
</mx:Application>