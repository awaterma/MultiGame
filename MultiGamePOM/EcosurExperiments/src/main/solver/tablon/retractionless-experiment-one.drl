# Copyright (C) 2009 ECOSUR, Andrew Waterman
#
# Licensed under the Academic Free License v. 3.2.
# http://www.opensource.org/licenses/afl-3.0.php
 
package mx.ecosur.multigame.impl.entity.tablon

import java.util.ArrayList;
import java.util.Set;

import org.drools.solver.core.score.constraint.UnweightedConstraintOccurrence
import org.drools.solver.core.score.calculator.SimpleScoreCalculator;

dialect "java"

global SimpleScoreCalculator scoreCalculator;


# Evaluates moves suggested by the WaterPathSuggestor.

# Hard constraints
rule "Board must be 4 x 4"
    when
    then
end

rule "No retractions"
    when
    then
end

rule "10 potreros per quadrant"
    when
    then
end

rule "2 forests per quadrant"
    when
    then
end

rule "4 riparians per quadrant"
    when
    then
end

#Constraint calculator update
rule "Constraints broken"
    when
        $occurrenceCount : Number() from accumulate(
            $unweightedConstraintOccurrence : UnweightedConstraintOccurrence(type == ConstraintType.NEGATIVE_HARD),
            count($unweightedConstraintOccurrence)
        );
    then
        scoreCalculator.setScore(- $occurrenceCount.intValue() );
end